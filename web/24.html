<!DOCTYPE html>
<html>
    <head>
        <title>24点</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.slim.js"></script>
        <style type="text/css">
  .ctrls { margin: 1em; }
  #input_pads button { font-size: 1.2em; margin: 0.3em; width: 2.3em;}
  #input_dis { width:10em; font-size: 1.5em; }
  #result p { font-size: 1.5em; font-weight: bold; }
        </style>
    </head>
    <body>

    <div align="center">
      <h1>计算24点</h1>
      <form id="input_form">
        <div id="input_pads">
          <div>
            <button data-value="1">A</button>
            <button data-value="2">2</button>
            <button data-value="3">3</button>
            <button data-value="4">4</button>
            <button data-value="5">5</button>
          </div>
          <div>
            <button data-value="6">6</button>
            <button data-value="7">7</button>
            <button data-value="8">8</button>
            <button data-value="9">9</button>
            <button data-value="10">10</button>
          </div>
          <div>
            <button data-value="11">J</button>
            <button data-value="12">Q</button>
            <button data-value="13">K</button>
          </div>
        </div>
        <div class="ctrls">
          <label>单解</label>
          <input id="input_singleAns" type="checkbox" name="findOne" checked />
          <input id="input_clear" type="button" name="clear" value="  清空  ">
        </div>
        <div class="ctrls">
          <input id="input_dis" type="text" readonly>
        </div>
      </form>

      <div id="result"></div>
    </div>
    </body>

<script type="text/javascript">

  var num_seq = [];

  $("#input_pads").on("click", "button", function (event) {
      event.preventDefault();
      var val = $(event.target).data("value");
      var text = $(event.target).text();
      var dis = $("#input_dis");
      dis.val(dis.val() + ' ' + text);

      num_seq.push(parseInt(val));
      if( num_seq.length != 4) {
        return;
      }

      var isfindOne = document.querySelector('#input_singleAns').checked;
      var answer = funMain(isfindOne, num_seq);
      if (Object.keys(answer).length === 0) {
        log("无答案")
      }
  });

  $("#input_clear").click(function(){
    num_seq = [];
    $("#input_dis").val('');
    $("#result").empty();
  });

  function log(str) {
    $("#result").append($("<p>").text(str));
  }

  function humanAnswer(exp) {
    exp = exp.replace(/\*/g, "×");
    exp = exp.replace(/\//g, "÷");
    exp = exp.replace(/11/g, "J");
    exp = exp.replace(/12/g, "Q");
    exp = exp.replace(/13/g, "K");
    exp = exp.replace(/1 /g, "A ");
    exp = exp.replace(/1$/g, "A");
    exp = exp.replace(/1\)/g, "A)");
    return exp;
  }

  //生成计算表达式
  function genExpress(exp, a, b, c, d, m1, m2, m3) {
    var exp = exp.replace("a", a);
    exp = exp.replace("b", b);
    exp = exp.replace("c", c);
    exp = exp.replace("d", d);
    exp = exp.replace("m1", m1);
    exp = exp.replace("m2", m2);
    exp = exp.replace("m3", m3);
    return exp;
  }

  //测试表达式是否正确
  function testExp(expn, a, b, c, d, m1, m2, m3) {
    var exp = genExpress(expn, a, b, c, d, m1, m2, m3);//生成计算表达式
    var ret = eval("(" + exp + ")");
    return Math.abs(ret - 24) < 0.1 ? exp : false;
  }

  //主程序
  function funMain(isfindOne, n) {
    var answer = {}; //正确答案的表达式

    //四种运算符
    var m = ["+", "-", "*", "/"];

    //11种表达式
    var expn = [
      "a m1 b m2 c m3 d",
      "(a m1 b) m2 c m3 d",
      "(a m1 b m2 c) m3 d",
      "((a m1 b) m2 c) m3 d",
      "(a m1 (b m2 c)) m3 d",
      "a m1 (b m2 c) m3 d",
      "a m1 (b m2 c m3 d)",
      "a m1 ((b m2 c) m3 d)",
      "a m1 (b m2 (c m3 d))",
      "a m1 b m2 (c m3 d)",
      "(a m1 b) m2 (c m3 d)"
    ];

    var a, b, c, d;//四个数字
    var m1, m2, m3;//三个运算符

    for (var i = 0; i < 4; i++) {
      a = n[i];
      for (var j = 0; j < 4; j++) {
        if (i == j) continue;//从未选的三个数字中选择一个数字
        b = n[j];
        for (var x = 0; x < 4; x++) {
          if (x == j || x == i) continue;//从未选的两个数字中选择一个数字
          c = n[x];
          for (var y = 0; y < 4; y++) {
            if (y == x || y == j || y == i) continue;//从未选的一个数字中选择一个数字
            d = n[y];

            for (var ta = 0; ta < 4; ta++) {
              m1 = m[ta];
              for (var tb = 0; tb < 4; tb++) {
                m2 = m[tb];
                for (var tc = 0; tc < 4; tc++) {
                  m3 = m[tc];
                  for (var k = 0; k < expn.length; k++) {
                    var exp = testExp(expn[k], a, b, c, d, m1, m2, m3)
                    if (exp === false) continue; // 
                    if (!(exp in answer)) {
                      answer[exp] = true;
                      log(humanAnswer(exp));
                    }
                    if (isfindOne) { return answer; }
                  }
                }
              }
            }
          }
        }
      }
    }
    return answer;
  }
</script>
</html>