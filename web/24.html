<!DOCTYPE html>
<html>
    <head>
        <title>24点</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style type="text/css">
  .ctrls { margin: 1em; }
  .num { font-size: 2em; width: 5em;}
        </style>
    </head>
    <body>

    <div align="center">
      <h1>计算24点(加、减、乘、除、括号)</h1>
      <form onsubmit="return funCount()" >
        <div class="ctrls">
          <input class="num" type="text" name="seq">
        </div>
        <div class="ctrls">
          <label>一个：</label><input type="checkbox" name="findOne" checked />
          <input type="button" name="clear" value="  清空  " onclick="clearResult()">
          <input type="submit" name="btn" value="  计算  ">
        </div>
      </form>

      <div id="result"></div>
    </div>
    </body>

<script type="text/javascript">
  function clearResult() {
    document.querySelector('input[name="seq"]').value = '';
    var rst = document.querySelector("#result")
    while (rst.firstChild) {
      rst.removeChild(rst.firstChild);
    }
  }

  function log(str) {
    console.log(str)
    var el = document.createElement('p');
    el.textContent = str;
    document.querySelector("#result").appendChild(el);
  }

  function humanAnswer(exp) {
    exp = exp.replace(/\*/g, "×");
    exp = exp.replace(/\//g, "÷");
    exp = exp.replace(/11/g, "J");
    exp = exp.replace(/12/g, "Q");
    exp = exp.replace(/13/g, "K");
    exp = exp.replace(/1 /g, "A ");
    exp = exp.replace(/1$/g, "A");
    exp = exp.replace(/1\)/g, "A)");
    return exp;
  }

  //生成计算表达式
  function genExpress(exp, a, b, c, d, m1, m2, m3) {
    var exp = exp.replace("a", a);
    exp = exp.replace("b", b);
    exp = exp.replace("c", c);
    exp = exp.replace("d", d);
    exp = exp.replace("m1", m1);
    exp = exp.replace("m2", m2);
    exp = exp.replace("m3", m3);
    return exp;
  }

  //测试表达式是否正确
  function testExp(expn, a, b, c, d, m1, m2, m3) {
    var exp = genExpress(expn, a, b, c, d, m1, m2, m3);//生成计算表达式
    var ret = eval("(" + exp + ")");
    return Math.abs(ret - 24) < 0.1 ? exp : false;
  }

  //接收四个输入框的数字，调用主程序
  function funCount() {
    try {

      var isfindOne = document.querySelector('input[name="findOne"]').checked;
      var seq = document.querySelector('input[name="seq"]').value.toUpperCase();
      var seq_ar = seq.split('');
      var num_seq = [];

      while (seq_ar.length > 0) {
        var digit = seq_ar.shift();
        switch (digit) {
          case 'A':
            num_seq.push(1);
            break;
          case 'J':
            num_seq.push(11);
            break;
          case 'Q':
            num_seq.push(12);
            break;
          case 'K':
            num_seq.push(13);
            break;
          case '1':
            if (seq_ar.length > 0 && seq_ar[0] === '0') {
              num_seq.push(10);
              seq_ar.shift();
            } else {
              num_seq.push(1);
            }
            break;
          default:
            num_seq.push(parseInt(digit));
        }
      }
      if (num_seq.length != 4) {
        alert("错误输入");
        return false;
      }
      console.log(num_seq);
      log("----" + num_seq.join(",") + "----")
      var answer = funMain(isfindOne, num_seq);
      if (Object.keys(answer).length === 0) {
        log("无答案")
      }

    } catch (e) {
      console.log(e);
    } finally {
      return false;
    }
  }

  //主程序
  function funMain(isfindOne, n) {
    var answer = {}; //正确答案的表达式

    //四种运算符
    var m = ["+", "-", "*", "/"];

    //11种表达式
    var expn = [
      "a m1 b m2 c m3 d",
      "(a m1 b) m2 c m3 d",
      "(a m1 b m2 c) m3 d",
      "((a m1 b) m2 c) m3 d",
      "(a m1 (b m2 c)) m3 d",
      "a m1 (b m2 c) m3 d",
      "a m1 (b m2 c m3 d)",
      "a m1 ((b m2 c) m3 d)",
      "a m1 (b m2 (c m3 d))",
      "a m1 b m2 (c m3 d)",
      "(a m1 b) m2 (c m3 d)"
    ];

    var a, b, c, d;//四个数字
    var m1, m2, m3;//三个运算符

    for (var i = 0; i < 4; i++) {
      a = n[i];
      for (var j = 0; j < 4; j++) {
        if (i == j) continue;//从未选的三个数字中选择一个数字
        b = n[j];
        for (var x = 0; x < 4; x++) {
          if (x == j || x == i) continue;//从未选的两个数字中选择一个数字
          c = n[x];
          for (var y = 0; y < 4; y++) {
            if (y == x || y == j || y == i) continue;//从未选的一个数字中选择一个数字
            d = n[y];

            for (var ta = 0; ta < 4; ta++) {
              m1 = m[ta];
              for (var tb = 0; tb < 4; tb++) {
                m2 = m[tb];
                for (var tc = 0; tc < 4; tc++) {
                  m3 = m[tc];
                  for (var k = 0; k < expn.length; k++) {
                    var exp = testExp(expn[k], a, b, c, d, m1, m2, m3)
                    if (exp === false) continue; // 
                    if (!(exp in answer)) {
                      answer[exp] = true;
                      log(humanAnswer(exp));
                    }
                    if (isfindOne) { return answer; }
                  }
                }
              }
            }
          }
        }
      }
    }
    return answer;
  }
</script>
</html>